<!DOCTYPE html>
<meta charset="utf-8">
<style>

.links path {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  stroke: #fff;
  stroke-width: 1.5px;
}
.view {
    stroke:none;
    fill:none;
}

</style>
<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var svg = d3.select("svg")
var width = +svg.attr("width");
var height = +svg.attr("height");

var container = svg.append("g")
var zoom = d3.zoom()
    .scaleExtent([1, 10])
    .on("zoom", zoomed);
    
var view = svg.append("rect")
    .attr("class", "view")
    .attr("x", 0.5)
    .attr("y", 0.5)
    .attr("width", width - 1)
    .attr("height", height - 1);
svg.call(zoom);

var color = d3.scaleOrdinal(d3.schemeCategory20);
var forceLink = d3.forceLink()
    .distance(300)
    .strength(1)
    .id(function(d) { return d.id; })

var simulation = d3.forceSimulation()
    .force("link", forceLink)
    .force("charge", d3.forceManyBody())
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("collide", d3.forceCollide( function(d){return d.r + 8 }).iterations(16) )

let graph = {
    "nodes": [
      {"id": "Myriel", "group": 1},
      {"id": "Napoleon", "group": 1},
      {"id": "Mlle.Baptistine", "group": 1},
      {"id": "Mme.Magloire", "group": 1}
    ],
    "links": [
      {"source": "Napoleon", "target": "Myriel", "value": 2, name: "a"},
      {"source": "Mlle.Baptistine", "target": "Myriel", "value": 2, name: "b"},
      {"source": "Mme.Magloire", "target": "Myriel", "value": 2, name: "c"},
      {"source": "Mme.Magloire", "target": "Mlle.Baptistine", "value": 2, name: "g"}
    ]
  }

var done = function( graph ) {

    var enter = container.append("g").attr("class", "links").selectAll("path").data(graph.links).enter();
    var link = enter.append("path")
        .attr('fill', 'none')
        .attr('id', function(d) {
            return d.name
        })

    enter.append("text")
        .style("font-size", "18px")
        .attr('text-anchor', 'middle')
        .attr('dy', -15)
        .append("textPath")
            .attr('startOffset', '50%')
            .attr("xlink:href", function(d) {
                return "#" + d.name 
            })
            .text(function(d) {
                return d.name
            });

        // .attr('d', line);
    // var enter = container.append("g").attr("class", "links").selectAll("line").data(graph.links).enter()
    // var link = enter.append("line")
    //     .attr("stroke-width", function(d) { return Math.sqrt(d.value); });


  var node = container.append("g")
    .attr("class", "nodes")
    .selectAll("circle")
    .data(graph.nodes)
        .enter().append("circle")
        .attr("r", 15)
        .attr('dx', 20)
        .attr('dy', 20)
        .attr("fill", function(d) { return color(d.group); })
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

  node.append("title")
      .text(function(d) { return d.id; });

  simulation
      .nodes(graph.nodes)
      .on("tick", ticked);

  simulation.force("link")
      .links(graph.links);

  function ticked() {
    link.attr("d", function(d) {
        var dx = d.target.x - d.source.x,
            dy = d.target.y - d.source.y,
            dr = 0
        return "M" +  d.source.x + "," +  d.source.y + "A" +  dr + "," + dr + " 0 0,1 " +  d.target.x + "," +  d.target.y;
    });
    node
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  }
}

done( graph )
function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.5).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

function zoomed( ) {
  container.attr("transform", d3.event.transform );
}

</script>